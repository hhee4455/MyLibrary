# 📕 DIP 의존성 역전 원칙  
DIP에서 말하는 **"유연성이 극대화된 시스템"** 이란  
소스 코드 의존성이 추상에 의존하며,  
구체에는 의존하지 않는 시스템을 의미한다.  

그러나, 이 아이디어를 **규칙으로 삼는 것은 비현실적**이다.  
모든 소프트웨어 시스템은 어느 정도 구체적인 요소에 의존할 수밖에 없기 때문이다.  

예를 들어, 자바의 `String` 클래스는 구체적인 클래스이지만,  
매우 안정적이며 변경될 가능성이 거의 없다.  
설령 변경되더라도, 이는 엄격하게 통제된다.  

이러한 이유로 DIP를 논할 때 운영체제나 플랫폼과 같은  
안정성이 보장된 환경에 대한 의존성은 무시하는 경우가 많다.  
이러한 환경은 변경되지 않는 한 의존해도 문제가 없다는 사실을 이미 알고 있기 때문이다.  

우리가 **의존하지 않도록 피해야 하는 것은 변동성이 큰 구체적인 요소**다.  
이러한 요소는 **우리가 직접 개발하는 중이며, 자주 변경될 가능성이 높은 모듈**들이다.  

## 📗 안정된 추상화  

인터페이스는 **구현체보다 변동성이 낮다.**  
따라서 **소프트웨어 설계의 기본 원칙은 인터페이스의 변동성을 낮추기 위해 노력하는 것**이다.  

**인터페이스를 변경하지 않고도 구현체에 기능을 추가할 방법을 찾는 것이 핵심이다.**  
즉, **안정된 소프트웨어 아키텍처란 변동성이 큰 구현체에 의존하지 않고,  
안정된 추상 인터페이스를 선호하는 아키텍처**를 의미한다.  

이를 실천하기 위한 구체적인 코딩 원칙을 정리하면 다음과 같다.  

### 📘 변동성이 큰 구체 클래스를 참조하지 말라.  
- 대신 **추상 인터페이스를 참조**하라.  
- 객체 생성 방식을 강하게 제약하며, **일반적으로 추상 팩토리를 사용하도록 강제**한다.  

### 📘 변동성이 큰 구체 클래스로부터 파생하지 말라.  
- **상속은 신중하게 사용해야 한다.**  
- 동적 타입 언어에서는 덜 문제가 될 수 있지만,  
  **의존성이 발생한다는 사실은 변함이 없다.**  
- 따라서, **상속은 최대한 신중하게 결정하는 것이 가장 현명한 선택**이다.  

### 📘 구체 함수를 오버라이드 하지 말라.  
- **구체 함수를 오버라이드하면 의존성을 제거할 수 없으며,  
  오히려 그 의존성을 상속하는 꼴이 된다.**  
- 의존성을 제거하려면, **차라리 추상 함수로 선언하고,  
  구현체에서 각자의 용도에 맞게 구현하는 것이 더 바람직하다.**  

### 📘 구체적이며 변동성이 크다면 절대로 그 이름을 언급하지 말라.  
- **DIP 원칙을 다른 방식으로 풀어쓴 것**으로,  
  변동성이 큰 구체 클래스에 직접적인 의존성을 두지 말라는 의미이다.  

## 📗 팩토리  
변동성이 큰 구체적인 객체는 신중하게 생성해야 한다.  
사실상 모든 언어에서 **객체를 생성할 때,  
구체적인 클래스에 대한 의존성이 발생**하기 때문이다.  

<img src="../Clean Architecture-로버트.C 마틴/img/11_1.png" alt="설명" width="500" style="display: block; margin: auto;">

위 그림에서 곡선은 아키텍처의 경계를 나타내며,  
구체적인 것과 추상적인 것을 분리하는 역할을 한다.  
의존성은 **해당 곡선을 교차할 때, 항상 추상적인 쪽을 향해야 한다.**  

곡선을 기준으로 시스템은 **두 가지 컴포넌트로 분리**된다.  
- **추상 컴포넌트**: 애플리케이션의 **고수준 업무 규칙**을 포함  
- **구체 컴포넌트**: 업무 규칙을 다루기 위해 필요한 **세부 구현**을 포함  

중요한 점은 **소스 코드 의존성이 제어 흐름과 반대 방향으로 역전된다는 것**이다.  
이러한 원리 때문에 **이 개념을 "의존성 역전"이라고 부른다.**  

## 📗 구체 컴포넌트  
위 그림에서 구체 컴포넌트에는 구체적인 의존성이 포함되어 있어 DIP를 위배한다.  
그러나 **모든 DIP 위배를 완전히 제거하는 것은 불가능하다.**  

하지만, DIP를 위배하는 클래스들을 소수의 구체 컴포넌트 내부로 모으면  
**시스템의 나머지 부분과 분리할 수 있다.**  

대다수의 시스템은 최소한 하나의 구체 컴포넌트를 포함하며,  
이 구체 컴포넌트는 일반적으로 애플리케이션의 Main을 포함하기 때문에  
흔히 **"메인"**이라고 부른다.  

## 📗 결론  
DIP는 아키텍처 다이어그램에서 가장 눈에 띄는 원칙이다.  
앞서 언급한 곡선은 아키텍처 경계를 의미한다.  

의존성은 **이 곡선을 기준으로, 더 추상적인 엔티티가 있는 방향으로 향해야 한다.**  
이러한 규칙은 **의존성 규칙**이라고도 불린다.  
